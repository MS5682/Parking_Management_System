<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>회원 정보 수정</title>
</head>
<body>
    <h1>회원 정보 수정</h1>
    <form>
        <label for="id">아이디:</label>
        <span id="id"><%= result.userInfo[0].id %></span><br>
        <label for="car_number">차 번호:</label>
        <ul id="carList">
            <% if (result.userCar && result.userCar.length) { %>
                <% for (let i = 0; i < result.userCar.length; i++) { %>
                    <li>
                        <span id="car_number<%= i %>"><%= result.userCar[i].car_number %></span>
                        <button type="button" onclick="editCar('<%= result.userCar[i].car_number %>')">수정하기</button>
                        <button type="button" onclick="deleteCar('<%= result.userCar[i].car_number %>')">삭제</button>
                    </li>
                <% } %>
            <% } else { %>
                <li>차 번호 정보가 없습니다.</li>
            <% } %>
        </ul>
        
        <!-- 추가하기 버튼 -->
        <label for="newCar">새로운 차 번호:</label>
        <input type="text" id="newCar" name="newCar">
        <button type="button" onclick="addCar('<%= result.userInfo[0].id %>')" >추가하기</button>

        <!-- ... (기존 버튼들) ... -->
    </form>
    
    <script>
        function editCar(currentCarNumber) {
            var newCarNumber = prompt('수정할 차 번호를 입력하세요:', currentCarNumber);
            if (newCarNumber !== null) {
                // 서버로 수정 요청 보내기
                fetch('/user/updateCar/' + currentCarNumber + '/' + newCarNumber, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (response.ok) {
                        // 수정 성공 시, 화면 업데이트
                        location.reload();
                    } else {
                        alert('수정에 실패했습니다.');
                    }
                });
            }
        }

        function deleteCar(carNumber) {
            var deletionConfirmation = confirm('정말로 삭제하시겠습니까?');
            if (deletionConfirmation) {
                // 서버로 삭제 요청 보내기
                fetch('/user/deleteCar/' + carNumber, {
                    method: 'POST',
                })
                .then(response => {
                    if (response.ok) {
                        // 삭제 성공 시, 화면에서 제거
                        location.reload();
                    } else {
                        alert('삭제에 실패했습니다.');
                    }
                });
            }
        }

        function addCar(userId) {
            var newCarNumber = document.getElementById('newCar').value;
            if (newCarNumber) {
                // 서버로 추가 요청 보내기
                fetch('/user/addCar/' + userId + '/' + newCarNumber, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (response.ok) {
                        // 추가 성공 시, 화면 업데이트
                        location.reload();
                    } else {
                        alert('추가에 실패했습니다.');
                    }
                });
            }
        }
    </script>
</body>
</html>
